fn f(t: f64, y: f64) -> f64 {
    t.powf(2.0) * y.sin() + y * (std::f64::consts::PI * t).sin()
}

fn euler(mut t: f64, t_final: f64, mut y: f64, h: f64) -> f64 {
    while t <= t_final {
        y = y + h * f(t, y);
        t += h;
    }

    y
}

fn pc(mut t: f64, t_final: f64, mut y: f64, h: f64, c: f64) -> f64 {
    while t <= t_final {
        y = y + h * (c * f(t, y) + (1.0 - c) * f(t + (1.0 / (2.0 * (1.0 - c))) * h, y + (1.0 / (2.0 * (1.0 - c))) * h * f(t, y)));
        t += h;
    }

    y
}

fn rkf4(t: f64, y: f64, h: f64) -> f64 {
    let mut k: [f64; 6] = [0.0; 6];

    k[0] = f(t, y);
    k[1] = f(t + (h / 5.0), y + h * k[0] / 5.0);
    k[2] = f(t + 3.0 * h / 10.0, y + 3.0 * h * k[1] / 40.0 + 9.0 * h * k[1] / 40.0);
    k[3] = f(t + 4.0 * h / 5.0, y + 44.0 * h * k[0] / 45.0 - 56.0 * h * k[1] / 15.0 + 32.0 * h * k[2] / 9.0);
    k[4] = f(t + 8.0 * h / 9.0, y + 19372.0 * h * k[0] / 6561.0 - 25360.0 * h * k[1] / 2187.0 + 64448.0 * h * k[2] / 6561.0 - 212.0 * h * k[3] / 729.0);
    k[5] = f(t + h, y + 9017.0 * h * k[0] / 3168.0 - 355.0 * h * k[1] / 33.0 + 46732.0 * h * k[3] / 5247.0 + 49.0 * h * k[3] / 176.0 - 5103.0 * h * k[4] / 18656.0);

    y + h * (35.0 * k[0] / 384.0 + 500.0 * k[2] / 1113.0 + 125.0 * k[3] / 192.0 - 2187.0 * k[4] / 6784.0 + 11.0 * k[5] / 84.0)
}

fn rkf5(t: f64, y: f64, h: f64) -> f64 {
    let mut k: [f64; 6] = [0.0; 6];

    k[0] = f(t, y);
    k[1] = f(t + (h / 5.0), y + h * k[0] / 5.0);
    k[2] = f(t + 3.0 * h / 10.0, y + 3.0 * h * k[1] / 40.0 + 9.0 * h * k[1] / 40.0);
    k[3] = f(t + 4.0 * h / 5.0, y + 44.0 * h * k[0] / 45.0 - 56.0 * h * k[1] / 15.0 + 32.0 * h * k[2] / 9.0);
    k[4] = f(t + 8.0 * h / 9.0, y + 19372.0 * h * k[0] / 6561.0 - 25360.0 * h * k[1] / 2187.0 + 64448.0 * h * k[2] / 6561.0 - 212.0 * h * k[3] / 729.0);
    k[5] = f(t + h, y + 9017.0 * h * k[0] / 3168.0 - 355.0 * h * k[1] / 33.0 + 46732.0 * h * k[3] / 5247.0 + 49.0 * h * k[3] / 176.0 - 5103.0 * h * k[4] / 18656.0);

    y + h * (35.0 * k[0] / 384.0 + 500.0 * k[2] / 1113.0 + 125.0 * k[3] / 192.0 - 2187.0 * k[4] / 6784.0 + 11.0 * k[5] / 84.0)
}

fn main() {
    println!("f({}, {}) = {} with Euler's method", 1, 3, euler(1.0, 3.0, 1.0, 0.1));
    println!("f({}, {}) = {} with RKF45", 1, 3, rkf4(1.0, 1.0, 0.1));
    /*
    println!("f({}, {}) = {} with c = {}", 1, 3, pc(1.0, 3.0, 1.0, 0.1, 0.0), 0.0);
    println!("f({}, {}) = {} with c = {}", 1, 3, pc(1.0, 3.0, 1.0, 0.1, 0.5), 0.5);
    println!("f({}, {}) = {} with c = {}", 1, 3, pc(1.0, 3.0, 1.0, 0.1, 0.25), 0.25);
    println!("f({}, {}) = {} with c = {}", 1, 3, pc(1.0, 3.0, 1.0, 0.1, 0.375), 0.375);
    */
}
